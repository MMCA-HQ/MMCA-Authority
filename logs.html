<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ - Ù…Ø§Ø±ÙÙ„</title>
    <style>
        :root { --army: #3d4921; --gold: #c5a059; --dark: #0b0c08; }
        body { background: var(--dark); color: #fff; font-family: Tahoma; padding: 20px; }
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-box { background: #14160f; border: 1px solid var(--army); padding: 30px; border-radius: 8px; width: 350px; text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 15px; background: #000; border: 1px solid var(--army); color: #fff; text-align: center; border-radius: 4px; }
        .btn-main { background: var(--gold); color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; border-radius: 4px; transition: 0.3s; }
        .btn-main:hover { opacity: 0.8; }
        #mainContent { display: none; }
        .panel { background: #14160f; border: 1px solid var(--army); padding: 20px; margin-bottom: 30px; border-radius: 8px; }
        h2 { color: var(--gold); border-right: 5px solid var(--gold); padding-right: 15px; margin-bottom: 20px; font-size: 1.2rem; }
        input, textarea { background: #000; color: #fff; border: 1px solid #333; padding: 10px; border-radius: 4px; margin: 5px; }
        table { width: 100%; border-collapse: collapse; background: #080905; margin-top: 15px; }
        th, td { border: 1px solid #1a1d12; padding: 10px; text-align: center; font-size: 0.85rem; }
        th { color: var(--gold); background: #0d0e0a; }
        .btn-del { background: #c0392b; color: #fff; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .log-box { background: #000; height: 300px; overflow-y: auto; padding: 15px; border: 1px solid #222; font-family: monospace; color: #00ff00; border-radius: 4px; }
        .footer { text-align: center; padding: 20px; color: var(--gold); border-top: 1px solid var(--army); margin-top: 40px; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-box">
        <h2 style="color:var(--gold)">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙŠØ§</h2>
        <input type="text" id="fakeCode" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ" value="">
        <input type="password" id="realPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-main" style="width:100%" onclick="checkAuth()">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div id="mainContent">
    <h1 style="text-align: center; color: var(--gold); margin-bottom: 40px;">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© - Ù…Ø§Ø±ÙÙ„</h1>

    <div class="panel">
        <h2>| Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø¶ÙˆØ§Ø¨Ø·</h2>
        <textarea id="rulesInput" style="width:95%; height:80px;" placeholder="Ø£Ø¯Ø®Ù„ Ù†Øµ Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯..."></textarea>
        <button class="btn-main" style="margin-top:10px" onclick="saveRules()">Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙˆØ·</button>
    </div>

    <div class="panel">
        <h2>| Ø¥Ø¯Ø§Ø±Ø© Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h2>
        <div class="controls">
            <input type="text" id="c_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©">
            <input type="text" id="c_p1" placeholder="Ø§Ù„ÙØªØ±Ø© 1">
            <input type="text" id="c_p2" placeholder="Ø§Ù„ÙØªØ±Ø© 2">
            <button class="btn-main" onclick="addCourse()">Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ù…ÙˆØ¹Ø¯</button>
        </div>
        <table id="coursesTable">
            <thead><tr><th>Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ù1</th><th>Ù2</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="panel">
        <h2>| Ø¥Ø¯Ø§Ø±Ø© Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙˆØ§Ù„ØªØµØ­ÙŠØ­</h2>
        <div class="controls">
            <input type="text" id="l_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©">
            <input type="text" id="l_exam" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±">
            <input type="text" id="l_corr" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØµØ­ÙŠØ­">
            <button class="btn-main" onclick="addLinks()">Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</button>
        </div>
        <table id="linksTable">
            <thead><tr><th>Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</th><th>Ø±Ø§Ø¨Ø· Ø§Ù„ØªØµØ­ÙŠØ­</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="panel">
        <h2>| Ø¥Ø¯Ø§Ø±Ø© Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙˆØ±Ø§Øª</h2>
        <div class="controls">
            <input type="text" id="s_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©">
            <textarea id="s_text" placeholder="Ù†Øµ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† Ø§Ù„ÙˆØ§Ø¶Ø­..." style="width: 400px; height: 40px;"></textarea>
            <button class="btn-main" onclick="addSurvey()">Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†</button>
        </div>
        <table id="surveysTable">
            <thead><tr><th>Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ù†Øµ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="panel">
        <h2>| Ø³Ø¬Ù„ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù†Ø¸Ø§Ù… (Logs) - Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</h2>
        <div id="logBox" class="log-box"></div>
    </div>

    <div class="footer">Ø­Ù‚ÙˆÙ‚ - Ø¯ÙˆÙ„Ø© Ù…Ø§Ø±ÙÙ„ | Ù‡ÙŠØ¦Ø© ØªÙ†Ø¸ÙŠÙ… Ø§Ù„Ø¯ÙˆØ±Ø§Øª Â© 2026</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyAALZ-v8wA_5mjUVSqW1uLXMwMkskpDaGM", databaseURL: "https://mmca-authority-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø¥ØµÙ„Ø§Ø­ Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ÙˆÙ‚Ø§Øª Ù„ÙŠØ¹Ù…Ù„ ÙÙˆØ±Ø§Ù‹
    function pushLog(msg) {
        const logData = { msg: msg, time: new Date().toLocaleString('ar-SA') };
        db.ref('system_logs').push(logData);
    }

    function checkAuth() {
        const pass = document.getElementById('realPass').value;
        const code = document.getElementById('fakeCode').value || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
        if (pass === "Ø±Ø¦ÙŠØ³_2026") {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            pushLog(`ğŸ‘‘ ØªÙ… Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ Ø¨Ù†Ø¬Ø§Ø­`);
        } else {
            pushLog(`âš ï¸ Ù…Ø­Ø§ÙˆÙ„Ø© Ø¯Ø®ÙˆÙ„ ÙØ§Ø´Ù„Ø© Ù„Ù„Ø±Ø¦ÙŠØ³! Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙƒØªÙˆØ¨: ( ${code} )`);
            alert("Ø®Ø·Ø£ ÙÙŠ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
        }
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ÙØµÙ„Ø©
    function saveRules() {
        const val = document.getElementById('rulesInput').value;
        db.ref('authority_data/rules').set(val);
        pushLog(`ğŸ“ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙˆØ· Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©`);
    }

    function addCourse() {
        const name = document.getElementById('c_name').value;
        if(!name) return;
        db.ref('authority_data/courses/' + name).set({
            name: name, p1: document.getElementById('c_p1').value, p2: document.getElementById('c_p2').value
        });
        pushLog(`ğŸ“… ØªÙ… Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¹Ø¯ Ø¯ÙˆØ±Ø©: ${name}`);
    }

    function addLinks() {
        const name = document.getElementById('l_name').value;
        if(!name) return;
        db.ref('authority_data/links/' + name).set({
            name: name, exam: document.getElementById('l_exam').value, corr: document.getElementById('l_corr').value
        });
        pushLog(`ğŸ”— ØªÙ… ØªØ­Ø¯ÙŠØ« Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±/Ø§Ù„ØªØµØ­ÙŠØ­ Ù„Ø¯ÙˆØ±Ø©: ${name}`);
    }

    function addSurvey() {
        const name = document.getElementById('s_name').value;
        if(!name) return;
        db.ref('authority_data/surveys/' + name).set({
            name: name, text: document.getElementById('s_text').value
        });
        pushLog(`ğŸ“‹ ØªÙ… ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù† Ù„Ø¯ÙˆØ±Ø©: ${name}`);
    }

    // ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø­Ø°Ù
    function deleteItem(path, name) {
        if(confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª ${name}ØŸ`)) {
            db.ref(path + name).remove();
            pushLog(`ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† ${path} Ù„Ù„Ø¯ÙˆØ±Ø©: ${name}`);
        }
    }

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
    db.ref().on('value', (snap) => {
        const root = snap.val() || {};
        const auth = root.authority_data || {};
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙˆØ·
        document.getElementById('rulesInput').value = auth.rules || "";

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯
        let hC = "";
        for(let key in auth.courses) {
            hC += `<tr><td>${auth.courses[key].name}</td><td>${auth.courses[key].p1}</td><td>${auth.courses[key].p2}</td>
            <td><button class="btn-del" onclick="deleteItem('authority_data/courses/','${key}')">Ø­Ø°Ù</button></td></tr>`;
        }
        document.querySelector("#coursesTable tbody").innerHTML = hC;

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
        let hL = "";
        for(let key in auth.links) {
            hL += `<tr><td>${auth.links[key].name}</td><td>${auth.links[key].exam}</td><td>${auth.links[key].corr}</td>
            <td><button class="btn-del" onclick="deleteItem('authority_data/links/','${key}')">Ø­Ø°Ù</button></td></tr>`;
        }
        document.querySelector("#linksTable tbody").innerHTML = hL;

        // ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª
        let hS = "";
        for(let key in auth.surveys) {
            hS += `<tr><td>${auth.surveys[key].name}</td><td>${auth.surveys[key].text}</td>
            <td><button class="btn-del" onclick="deleteItem('authority_data/surveys/','${key}')">Ø­Ø°Ù</button></td></tr>`;
        }
        document.querySelector("#surveysTable tbody").innerHTML = hS;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„ÙˆÙ‚Ø§Øª (Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹Ø±Ø¶)
        let hLog = "";
        const logs = root.system_logs || {};
        const logEntries = Object.values(logs).reverse().slice(0, 50);
        logEntries.forEach(l => {
            hLog += `<div style="margin-bottom:5px; border-bottom:1px solid #111;">[${l.time}] ${l.msg}</div>`;
        });
        document.getElementById('logBox').innerHTML = hLog;
    });
</script>
</body>
</html>
