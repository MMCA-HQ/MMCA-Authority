<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ - Ù…Ø§Ø±ÙÙ„</title>
    <style>
        :root { --army: #3d4921; --gold: #c5a059; --dark: #0b0c08; }
        body { background: var(--dark); color: #fff; font-family: Tahoma; padding: 20px; }
        .panel { background: #14160f; border: 1px solid var(--army); padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        h2 { color: var(--gold); border-right: 5px solid var(--gold); padding-right: 10px; }
        input, textarea { background: #000; color: #fff; border: 1px solid #333; padding: 8px; margin: 5px; border-radius: 4px; width: 250px; }
        .btn-gold { background: var(--gold); border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; border-radius: 4px; }
        .log-box { background: #000; height: 250px; overflow-y: auto; padding: 15px; border: 1px solid #222; color: #00ff00; font-family: monospace; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #222; padding: 8px; text-align: center; font-size: 0.9rem; }
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div style="background:#14160f; padding:40px; border:1px solid var(--army); text-align:center; border-radius:8px;">
        <h2 style="color:var(--gold)">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø¦ÙŠØ³</h2>
        <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="width:100%"><br><br>
        <button class="btn-gold" onclick="login()" style="width:100%">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<div id="content" style="display:none;">
    <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ù„ÙŠØ§ - Ù…Ø§Ø±ÙÙ„</h1>

    <div class="panel">
        <h2>| Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø±ÙˆØ·</h2>
        <textarea id="rules" style="width:90%; height:50px;"></textarea><br>
        <button class="btn-gold" onclick="updateRules()">Ø­ÙØ¸ Ø§Ù„Ø´Ø±ÙˆØ·</button>
    </div>

    <div class="panel">
        <h2>| Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h2>
        <input type="text" id="c_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©">
        <input type="text" id="c_p1" placeholder="Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰">
        <input type="text" id="c_p2" placeholder="Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©">
        <button class="btn-gold" onclick="saveItem('courses', 'c_name', ['p1','p2'], ['c_p1','c_p2'])">Ø¥Ø¶Ø§ÙØ©/ØªØ¹Ø¯ÙŠÙ„</button>
        <table id="table_courses"><thead><tr><th>Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ù1</th><th>Ù2</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="panel">
        <h2>| Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†Ø§Øª</h2>
        <input type="text" id="l_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¯ÙˆØ±Ø©">
        <input type="text" id="l_test" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±">
        <input type="text" id="l_corr" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØªØµØ­ÙŠØ­">
        <input type="text" id="l_surv" placeholder="Ù†Øµ Ø§Ù„Ø§Ø³ØªØ¨ÙŠØ§Ù†">
        <button class="btn-gold" onclick="saveItem('links', 'l_name', ['test','corr','surv'], ['l_test','l_corr','l_surv'])">Ø­ÙØ¸</button>
        <table id="table_links"><thead><tr><th>Ø§Ù„Ø¯ÙˆØ±Ø©</th><th>Ø§Ø®ØªØ¨Ø§Ø±</th><th>ØªØµØ­ÙŠØ­</th><th>Ø§Ø³ØªØ¨ÙŠØ§Ù†</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="panel">
        <h2>| Ù†Ø¸Ø§Ù… Ø§Ù„Ù„ÙˆÙ‚Ø§Øª Ø§Ù„Ù…ØªØµÙ„ (Logs)</h2>
        <div id="logBox" class="log-box"></div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
    const firebaseConfig = { apiKey: "AIzaSyAALZ-v8wA_5mjUVSqW1uLXMwMkskpDaGM", databaseURL: "https://mmca-authority-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function login() {
        if(document.getElementById('pass').value === "Ø±Ø¦ÙŠØ³_2026") {
            document.getElementById('loginOverlay').style.display='none';
            document.getElementById('content').style.display='block';
            addLog("ğŸ‘‘ Ø§Ù„Ø±Ø¦ÙŠØ³ Ø¯Ø®Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…");
        } else alert("Ø®Ø·Ø£");
    }

    function addLog(m) { db.ref('logs').push({ msg: m, time: new Date().toLocaleString('ar-SA') }); }

    function updateRules() {
        const val = document.getElementById('rules').value;
        db.ref('settings/rules').set(val);
        addLog("ğŸ“ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¹Ø§Ù…Ø©");
    }

    function saveItem(path, nameId, keys, inputIds) {
        const name = document.getElementById(nameId).value;
        if(!name) return;
        let data = { name: name };
        keys.forEach((k, i) => data[k] = document.getElementById(inputIds[i]).value);
        db.ref(path + '/' + name).set(data);
        addLog(`ğŸ› ï¸ ØªØ¹Ø¯ÙŠÙ„/Ø¥Ø¶Ø§ÙØ© ÙÙŠ ${path}: ${name}`);
        [nameId, ...inputIds].forEach(id => document.getElementById(id).value = "");
    }

    db.ref().on('value', snap => {
        const data = snap.val() || {};
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ù„ÙˆÙ‚Ø§Øª ÙÙˆØ±Ø§Ù‹
        let hC="", hL="", hLogs="";
        for(let i in data.courses) hC += `<tr><td>${i}</td><td>${data.courses[i].p1}</td><td>${data.courses[i].p2}</td><td><button onclick="db.ref('courses/${i}').remove()">Ø­Ø°Ù</button></td></tr>`;
        for(let i in data.links) hL += `<tr><td>${i}</td><td>${data.links[i].test}</td><td>${data.links[i].corr}</td><td>${data.links[i].surv}</td><td><button onclick="db.ref('links/${i}').remove()">Ø­Ø°Ù</button></td></tr>`;
        Object.values(data.logs || {}).reverse().forEach(l => hLogs += `<div>[${l.time}] ${l.msg}</div>`);
        
        document.querySelector("#table_courses tbody").innerHTML = hC;
        document.querySelector("#table_links tbody").innerHTML = hL;
        document.getElementById('logBox').innerHTML = hLogs;
        document.getElementById('rules').value = data.settings?.rules || "";
    });
</script>
</body>
</html>
