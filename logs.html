<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة الرئيس | دولة مارفل</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --army: #3d4921;
            --gold: #c5a059;
            --dark-bg: #0b0c08;
            --panel-bg: #14160f;
            --input-bg: #000000;
            --border: #1a1d12;
            --error: #e74c3c;
            --blue: #3498db;
        }

        body {
            background: var(--dark-bg);
            color: #fff;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0;
            padding: 20px;
            display: none; /* حماية بكلمة المرور */
        }

        .container { max-width: 1000px; margin: 0 auto; }

        h1 { text-align: center; color: var(--gold); border-bottom: 2px solid var(--army); padding-bottom: 10px; }

        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--army);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
        }

        h2 {
            color: var(--gold);
            font-size: 1.2rem;
            border-right: 5px solid var(--gold);
            padding-right: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        input, textarea {
            background: var(--input-bg);
            color: #fff;
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 6px;
            flex: 1;
            font-family: Tahoma;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.3s;
        }

        .btn-gold { background: var(--gold); color: #000; }
        .btn-gold:hover { opacity: 0.8; }
        .btn-edit { background: var(--blue); color: #fff; font-size: 0.8rem; margin-left: 5px; }
        .btn-del { background: var(--error); color: #fff; font-size: 0.8rem; }

        table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            text-align: center;
        }

        th { background: #0d0e0a; color: var(--gold); font-size: 0.9rem; }
        
        .status-box {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 4px;
            font-size: 0.8rem;
            background: var(--army);
            color: var(--gold);
        }
    </style>
</head>
<body>

<div class="container">
    <h1>لوحة القيادة العليا</h1>

    <div class="panel">
        <h2>| إدارة الشروط</h2>
        <textarea id="rulesText" placeholder="اكتب الشروط العامة هنا..."></textarea>
        <button class="btn btn-gold" style="width:100%; margin-top:10px;" onclick="saveRules()">تحديث الشروط</button>
    </div>

    <div class="panel">
        <h2>| إدارة الدورات والمواعيد</h2>
        <div class="controls">
            <input type="hidden" id="edit_course_id">
            <input type="text" id="c_name" placeholder="اسم الدورة">
            <input type="text" id="c_p1" placeholder="الفترة 1">
            <input type="text" id="c_p2" placeholder="الفترة 2">
            <button class="btn btn-gold" id="btn_c_save" onclick="addOrUpdateCourse()">حفظ جديد</button>
        </div>
        <table>
            <thead><tr><th>الدورة</th><th>فترة 1</th><th>فترة 2</th><th>التحكم</th></tr></thead>
            <tbody id="t_courses"></tbody>
        </table>
    </div>

    <div class="panel" style="border-color: var(--error);">
        <h2>| إدارة شؤون المتقدمين</h2>
        <div class="controls">
            <input type="hidden" id="edit_app_id">
            <input type="text" id="app_name" placeholder="اسم المتقدم">
            <input type="text" id="app_code" placeholder="الكود العسكري">
            <button class="btn btn-gold" id="btn_app_save" onclick="addOrUpdateApp()">إضافة متقدم</button>
        </div>
        <table>
            <thead><tr><th>الاسم</th><th>الكود</th><th>التحكم</th></tr></thead>
            <tbody id="t_apps"></tbody>
        </table>
    </div>

    <div class="panel">
        <h2>| روابط الاختبارات</h2>
        <div class="controls">
            <input type="hidden" id="edit_exam_id">
            <input type="text" id="e_name" placeholder="اسم الدورة">
            <input type="text" id="e_url" placeholder="الرابط">
            <button class="btn btn-gold" id="btn_e_save" onclick="addOrUpdate('exams', 'e_name', 'e_url', 'edit_exam_id', 'btn_e_save')">حفظ</button>
        </div>
        <table id="t_exams"><thead><tr><th>الدورة</th><th>الرابط</th><th>التحكم</th></tr></thead><tbody></tbody></table>
    </div>

    <div class="panel">
        <h2>| روابط التصحيح</h2>
        <div class="controls">
            <input type="hidden" id="edit_corr_id">
            <input type="text" id="co_name" placeholder="اسم الدورة">
            <input type="text" id="co_url" placeholder="الرابط">
            <button class="btn btn-gold" id="btn_co_save" onclick="addOrUpdate('correction', 'co_name', 'co_url', 'edit_corr_id', 'btn_co_save')">حفظ</button>
        </div>
        <table id="t_correction"><thead><tr><th>الدورة</th><th>الرابط</th><th>التحكم</th></tr></thead><tbody></tbody></table>
    </div>

</div>

<script>
    // 1. نظام كلمة المرور
    const pass = prompt("الرمز السري لدخول الرئيس:");
    if (pass === "رئيس_2026") {
        document.body.style.display = "block";
    } else {
        alert("خطأ في الرمز!");
        window.location.href = "index.html";
    }

    const firebaseConfig = { apiKey: "AIzaSyAALZ-v8wA_5mjUVSqW1uLXMwMkskpDaGM", databaseURL: "https://mmca-authority-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // 2. إدارة الشروط
    function saveRules() {
        db.ref('authority_data/rules').set(document.getElementById('rulesText').value).then(() => alert("تم التحديث"));
    }

    // 3. إدارة الدورات (إضافة + تعديل + حذف)
    function addOrUpdateCourse() {
        const id = document.getElementById('edit_course_id').value;
        const data = { name: document.getElementById('c_name').value, p1: document.getElementById('c_p1').value, p2: document.getElementById('c_p2').value };
        if(!data.name) return;
        if(id) db.ref('authority_data/courses/' + id).update(data);
        else db.ref('authority_data/courses').push(data);
        resetFields(['edit_course_id', 'c_name', 'c_p1', 'c_p2'], 'btn_c_save', 'حفظ جديد');
    }

    // 4. إدارة المتقدمين (إضافة + تعديل + حذف)
    function addOrUpdateApp() {
        const id = document.getElementById('edit_app_id').value;
        const data = { name: document.getElementById('app_name').value, code: document.getElementById('app_code').value };
        if(!data.name || !data.code) return;
        if(id) db.ref('applications/' + id).update(data);
        else db.ref('applications').push(data);
        resetFields(['edit_app_id', 'app_name', 'app_code'], 'btn_app_save', 'إضافة متقدم');
    }

    // 5. إدارة الروابط العامة
    function addOrUpdate(path, nId, uId, hId, bId) {
        const id = document.getElementById(hId).value;
        const data = { course: document.getElementById(nId).value, url: document.getElementById(uId).value };
        if(!data.course || !data.url) return;
        if(id) db.ref('authority_data/' + path + '/' + id).update(data);
        else db.ref('authority_data/' + path).push(data);
        resetFields([hId, nId, uId], bId, 'حفظ جديد');
    }

    function resetFields(ids, bId, txt) {
        ids.forEach(i => document.getElementById(i).value = "");
        document.getElementById(bId).innerText = txt;
    }

    // 6. التحضير للتعديل
    function editC(id, n, p1, p2) {
        document.getElementById('edit_course_id').value = id;
        document.getElementById('c_name').value = n; document.getElementById('c_p1').value = p1; document.getElementById('c_p2').value = p2;
        document.getElementById('btn_c_save').innerText = "تحديث البيانات";
    }

    function editApp(id, n, c) {
        document.getElementById('edit_app_id').value = id;
        document.getElementById('app_name').value = n; document.getElementById('app_code').value = c;
        document.getElementById('btn_app_save').innerText = "تحديث المتقدم";
    }

    function editItem(id, n, u, h, ni, ui, b) {
        document.getElementById(h).value = id;
        document.getElementById(ni).value = n; document.getElementById(ui).value = u;
        document.getElementById(b).innerText = "تحديث التعديل";
    }

    // 7. مزامنة البيانات اللحظية
    db.ref().on('value', snap => {
        const data = snap.val() || {};
        const auth = data.authority_data || {};
        const apps = data.applications || {};
        
        document.getElementById('rulesText').value = auth.rules || "";

        // عرض الدورات
        let hC = "";
        for(let i in auth.courses) {
            let c = auth.courses[i];
            hC += `<tr><td>${c.name}</td><td>${c.p1}</td><td>${c.p2}</td><td>
                <button class="btn btn-edit" onclick="editC('${i}','${c.name}','${c.p1}','${c.p2}')">تعديل</button>
                <button class="btn btn-del" onclick="db.ref('authority_data/courses/${i}').remove()">حذف</button></td></tr>`;
        }
        document.getElementById('t_courses').innerHTML = hC;

        // عرض المتقدمين
        let hA = "";
        for(let i in apps) {
            hA += `<tr><td>${apps[i].name}</td><td>${apps[i].code}</td><td>
                <button class="btn btn-edit" onclick="editApp('${i}','${apps[i].name}','${apps[i].code}')">تعديل</button>
                <button class="btn btn-del" onclick="db.ref('applications/${i}').remove()">حذف</button></td></tr>`;
        }
        document.getElementById('t_apps').innerHTML = hA;

        // عرض الروابط
        const paths = { exams: 't_exams', correction: 't_correction' };
        const meta = { exams: ['edit_exam_id','e_name','e_url','btn_e_save'], correction: ['edit_corr_id','co_name','co_url','btn_co_save'] };
        for(let p in paths) {
            let html = "";
            for(let i in auth[p]) {
                let it = auth[p][i];
                html += `<tr><td>${it.course}</td><td style="font-size:0.7rem; color:#666">${it.url}</td><td>
                    <button class="btn btn-edit" onclick="editItem('${i}','${it.course}','${it.url}','${meta[p][0]}','${meta[p][1]}','${meta[p][2]}','${meta[p][3]}')">تعديل</button>
                    <button class="btn btn-del" onclick="db.ref('authority_data/${p}/${i}').remove()">حذف</button></td></tr>`;
            }
            document.querySelector(`#${paths[p]} tbody`).innerHTML = html;
        }
    });
</script>
</body>
</html>
