<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>رئيس الهيئة | الإدارة والتحرير</title>
    <style>
        :root { --army: #3d4921; --gold: #c5a059; --dark: #0b0c08; }
        body { background: var(--dark); color: #fff; font-family: Tahoma; padding: 20px; }
        .boss-panel { border: 2px solid var(--gold); padding: 15px; background: #14160f; margin-bottom: 20px; text-align: right; border-radius: 8px; }
        h3 { color: var(--gold); margin-top: 0; border-bottom: 1px solid var(--army); padding-bottom: 10px; }
        input, textarea { width: 100%; background: #000; color: #fff; border: 1px solid var(--army); padding: 12px; margin: 8px 0; box-sizing: border-box; border-radius: 4px; }
        .btn { background: var(--gold); color: #000; padding: 12px; width: 100%; font-weight: bold; cursor: pointer; border: none; margin-top: 5px; border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: #000; }
        th, td { border: 1px solid var(--army); padding: 10px; text-align: center; }
        th { color: var(--gold); }
        .footer { margin-top: 50px; text-align: center; color: #444; font-size: 0.8rem; border-top: 1px solid #222; padding-top: 20px; }
    </style>
</head>
<body>

    <h1 style="text-align: center; color: var(--gold);">مكتب رئيس الهيئة - الإدارة والتحكم</h1>

    <script>
        let pass = prompt("الرجاء إدخال الرمز السري للوصول إلى السجلات:");
        if (pass !== "رئيس_2026") { 
            alert("دخول غير مصرح!");
            window.location.href = "index.html";
        }
    </script>

    <div class="boss-panel">
        <h3>شروط الالتحاق بالدورات</h3>
        <textarea id="e_cond" rows="4" placeholder="اكتب الشروط هنا..."></textarea>
        <button class="btn" onclick="saveCond()">تحديث الشروط ونشرها</button>
    </div>

    <div class="boss-panel">
        <h3>إدارة مواعيد الدورات</h3>
        <input type="text" id="c_name" placeholder="اسم الدورة">
        <input type="text" id="c_p1" placeholder="موعد الفترة 1">
        <input type="text" id="c_p2" placeholder="موعد الفترة 2">
        <button class="btn" style="background:#2ecc71" onclick="saveCourse()">حفظ الدورة ونشر المواعيد</button>
    </div>

    <div class="footer">جميع الحقوق محفوظة © 2026 - دولة مارفل</div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // إعدادات Firebase الخاصة بك
        const firebaseConfig = {
            apiKey: "AIzaSyAALZ-v8wA_5mjUVSqW1uLXMwMkskpDaGM",
            authDomain: "mmca-authority.firebaseapp.com",
            databaseURL: "https://mmca-authority-default-rtdb.firebaseio.com",
            projectId: "mmca-authority",
            storageBucket: "mmca-authority.firebasestorage.app",
            messagingSenderId: "105278081999",
            appId: "1:105278081999:web:e1864fd2c50ebe116ca0ba"
        };

        // تفعيل Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // 1. وظيفة تحديث الشروط (تطرد null فوراً)
        function saveCond() {
            const rulesVal = document.getElementById('e_cond').value;
            if (!rulesVal) { alert("الرجاء كتابة الشروط أولاً"); return; }
            
            db.ref('authority_data/rules').set(rulesVal).then(() => {
                alert("✅ تم التحديث! اختفت كلمة null من السحاب وظهرت نصوصك.");
            }).catch(err => alert("خطأ في الاتصال: " + err));
        }

        // 2. وظيفة حفظ الدورة
        function saveCourse() {
            const name = document.getElementById('c_name').value;
            const p1 = document.getElementById('c_p1').value;
            const p2 = document.getElementById('c_p2').value;

            if (!name) { alert("الرجاء إدخال اسم الدورة"); return; }

            db.ref('authority_data/courses').set({
                courseName: name,
                period1: p1,
                period2: p2
            }).then(() => {
                alert("✅ تم نشر مواعيد الدورة بنجاح!");
            }).catch(err => alert("خطأ في الاتصال: " + err));
        }

        // جلب البيانات الحالية عند فتح الصفحة لرؤيتها في المربعات
        db.ref('authority_data').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                if (data.rules) document.getElementById('e_cond').value = data.rules;
                if (data.courses) {
                    document.getElementById('c_name').value = data.courses.courseName || '';
                    document.getElementById('c_p1').value = data.courses.period1 || '';
                    document.getElementById('c_p2').value = data.courses.period2 || '';
                }
            }
        });
    </script>
</body>
</html>
