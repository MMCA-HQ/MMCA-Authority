<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>لوحة الرئيس | دولة مارفل</title>
    <style>
        :root { --army: #3d4921; --gold: #c5a059; --dark: #0b0c08; }
        body { background: var(--dark); color: #fff; font-family: Tahoma; padding: 20px; display: none; }
        .panel { background: #14160f; border: 1px solid var(--army); padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        h2 { color: var(--gold); border-right: 5px solid var(--gold); padding-right: 15px; }
        input, textarea { background: #000; color: #fff; border: 1px solid #333; padding: 10px; margin: 5px; width: 200px; }
        .btn-main { background: var(--gold); border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        .log-box { background: #000; height: 300px; overflow-y: scroll; padding: 15px; border: 1px solid #333; color: #2ecc71; font-family: monospace; font-size: 0.85rem; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #1a1d12; padding: 10px; }
    </style>
</head>
<body>
    <h1 style="text-align: center; color: var(--gold);">لوحة التحكم العليا</h1>

    <div class="panel">
        <h2>| سجل اللوقات المتصل (دائم)</h2>
        <div id="logBox" class="log-box"></div>
    </div>

    <div class="panel">
        <h2>| إدارة المواعيد والشروط</h2>
        <textarea id="rulesInput" style="width:100%; height:50px;"></textarea><br>
        <button class="btn-main" onclick="saveRules()">حفظ الشروط</button>
        <hr>
        <input type="text" id="c_name" placeholder="اسم الدورة">
        <input type="text" id="c_p1" placeholder="ف1">
        <input type="text" id="c_p2" placeholder="ف2">
        <button class="btn-main" onclick="addCourse()">إضافة دورة</button>
    </div>

    <div class="panel" style="border-color: #e74c3c;">
        <h2>| التحكم الفردي بالمتقدمين</h2>
        <table>
            <thead><tr><th>المتقدم</th><th>الكود</th><th>الإجراء</th></tr></thead>
            <tbody id="manageApps"></tbody>
        </table>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        let p = prompt("الرمز السري:");
        if (p === "رئيس_2026") {
            document.body.style.display="block";
            const firebaseConfig = { apiKey: "AIzaSyAALZ-v8wA_5mjUVSqW1uLXMwMkskpDaGM", databaseURL: "https://mmca-authority-default-rtdb.firebaseio.com" };
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();

            function saveRules() { db.ref('authority_data/rules').set(document.getElementById('rulesInput').value); }
            function addCourse() { 
                db.ref('authority_data/courses').push({
                    name: document.getElementById('c_name').value,
                    p1: document.getElementById('c_p1').value,
                    p2: document.getElementById('c_p2').value
                });
            }
            function deleteApp(id) { if(confirm("حذف؟")) db.ref('applications/'+id).remove(); }

            db.ref().on('value', snap => {
                const root = snap.val() || {}; const auth = root.authority_data || {}; const apps = root.applications || {};
                
                // اللوقات
                let lHtml = "";
                const logs = Object.values(auth.logs || {}).reverse();
                logs.forEach(l => lHtml += `<div>[${l.time}] ${l.msg}</div>`);
                document.getElementById('logBox').innerHTML = lHtml;
                document.getElementById('rulesInput').value = auth.rules || "";

                // إدارة المتقدمين
                let mHtml = "";
                for(let id in apps) mHtml += `<tr><td>${apps[id].name}</td><td>${apps[id].code}</td><td><button onclick="deleteApp('${id}')" style="background:#e74c3c; color:#fff; border:none; padding:5px;">حذف نهائي</button></td></tr>`;
                document.getElementById('manageApps').innerHTML = mHtml;
            });
        } else { window.location.href="index.html"; }
    </script>
</body>
</html>
