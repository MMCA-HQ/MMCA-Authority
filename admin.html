<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>إدارة المشرفين | مارفل</title>
    <style>
        :root { --army: #3d4921; --gold: #c5a059; --dark: #0b0c08; }
        body { background: var(--dark); color: #fff; font-family: Tahoma; padding: 20px; }
        #loginOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-box { background: #14160f; border: 1px solid var(--army); padding: 30px; border-radius: 8px; width: 320px; text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid var(--army); color: #fff; text-align: center; }
        #mainContent { display: none; }
        .panel { background: #14160f; border: 1px solid var(--army); padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #222; padding: 10px; text-align: center; }
        .btn-acc { background: #27ae60; color: #fff; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
        .btn-rej { background: #c0392b; color: #fff; border: none; padding: 5px 10px; cursor: pointer; border-radius: 3px; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h2 style="color:var(--gold)">نظام المشرفين</h2>
            <input type="text" placeholder="اسم المشرف">
            <input type="password" id="adminPass" placeholder="كلمة المرور">
            <button class="btn-acc" style="width:100%" onclick="checkAuth()">دخول</button>
        </div>
    </div>

    <div id="mainContent">
        <h1 style="color:var(--gold); text-align:center;">لوحة العمليات الميدانية</h1>
        
        <div class="panel">
            <h2>| طلبات الالتحاق الجديدة</h2>
            <table>
                <thead><tr><th>الاسم</th><th>الدورة</th><th>الإجراء</th></tr></thead>
                <tbody id="tbody_apps"></tbody>
            </table>
        </div>

        <div class="panel">
            <h2>| رصد نتائج الاختبارات</h2>
            <table>
                <thead><tr><th>الاسم</th><th>الحالة</th><th>رصد النتيجة</th></tr></thead>
                <tbody id="tbody_results"></tbody>
            </table>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        const firebaseConfig = { apiKey: "AIzaSyAALZ-v8wA_5mjUVSqW1uLXMwMkskpDaGM", databaseURL: "https://mmca-authority-default-rtdb.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function checkAuth() {
            if(document.getElementById('adminPass').value === "مشرف_2026") {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                pushLog("قام مشرف بتسجيل الدخول");
            } else { alert("كلمة المرور غير صحيحة"); }
        }

        function pushLog(msg) {
            db.ref('system_logs').push({ action: msg, time: new Date().toLocaleString('ar-SA') });
        }

        function setStatus(id, name, stat) {
            db.ref('applications/'+id).update({status: stat});
            pushLog(`المشرف قام بـ ${stat} المتقدم: ${name}`);
        }

        function setPass(id, name, res) {
            db.ref('applications/'+id).update({pass: res});
            pushLog(`المشرف رصد نتيجة (${res}) للمتقدم: ${name}`);
        }

        db.ref('applications').on('value', (snap) => {
            const apps = snap.val() || {};
            let h1 = "", h2 = "";
            for(let id in apps) {
                h1 += `<tr><td>${apps[id].name}</td><td>${apps[id].course}</td>
                <td><button class="btn-acc" onclick="setStatus('${id}','${apps[id].name}','مقبول')">قبول</button> 
                <button class="btn-rej" onclick="setStatus('${id}','${apps[id].name}','مرفوض')">رفض</button></td></tr>`;
                
                if(apps[id].status === 'مقبول') {
                    h2 += `<tr><td>${apps[id].name}</td><td>${apps[id].pass || 'بانتظار الاختبار'}</td>
                    <td><button class="btn-acc" onclick="setPass('${id}','${apps[id].name}','ناجح')">ناجح</button> 
                    <button class="btn-rej" onclick="setPass('${id}','${apps[id].name}','راسب')">راسب</button></td></tr>`;
                }
            }
            document.getElementById('tbody_apps').innerHTML = h1;
            document.getElementById('tbody_results').innerHTML = h2;
        });
    </script>
</body>
</html>
