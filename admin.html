<script>
    let admCode = prompt("Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠ:");
    let p = prompt("Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ:");
    if (p === "Ù…Ø´Ø±Ù_2026") { document.body.style.display="block"; } else { window.location.href="index.html"; }

    const firebaseConfig = { apiKey: "AIzaSyAALZ-v8wA_5mjUVSqW1uLXMwMkskpDaGM", databaseURL: "https://mmca-authority-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Ø¥Ø±Ø³Ø§Ù„ Ù„ÙˆÙ‚ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø´Ø±Ù
    db.ref('authority_data/logs').push({ msg: `ğŸ”“ Ø¯Ø®Ù„ Ø§Ù„Ù…Ø´Ø±Ù: ${admCode}`, time: new Date().toLocaleString('ar-SA') });

    function setStatus(id, name, val) {
        db.ref('applications/' + id).update({ status: val });
        db.ref('authority_data/logs').push({ msg: `âš™ï¸ Ø§Ù„Ù…Ø´Ø±Ù ${admCode} Ø­Ø¯Ø¯ Ø­Ø§Ù„Ø© ${name} Ø¨Ù€ ${val}`, time: new Date().toLocaleString('ar-SA') });
    }

    function setPass(id, name, val) {
        db.ref('applications/' + id).update({ pass: val });
        db.ref('authority_data/logs').push({ msg: `ğŸ† Ø§Ù„Ù…Ø´Ø±Ù ${admCode} Ø­Ø¯Ø¯ Ù†ØªÙŠØ¬Ø© ${name} Ø¨Ù€ ${val}`, time: new Date().toLocaleString('ar-SA') });
    }

    db.ref().on('value', snap => {
        const root = snap.val() || {};
        const auth = root.authority_data || {};
        const apps = root.applications || {};
        
        let hAcc = "", hPass = "", hPer = "", hSched = "";
        for(let id in apps) {
            let a = apps[id];
            hAcc += `<tr><td>${a.name}</td><td>${a.code}</td><td>${a.course}</td><td>
                <button class="btn-action btn-accept" onclick="setStatus('${id}','${a.name}','Ù…Ù‚Ø¨ÙˆÙ„')">Ù‚Ø¨ÙˆÙ„</button>
                <button class="btn-action btn-reject" onclick="setStatus('${id}','${a.name}','Ù…Ø±ÙÙˆØ¶')">Ø±ÙØ¶</button>
            </td></tr>`;
            if(a.status === 'Ù…Ù‚Ø¨ÙˆÙ„') {
                hPer += `<tr><td>${a.name}</td><td>${a.code}</td><td>${a.course}</td><td>${a.period}</td></tr>`;
                hPass += `<tr><td>${a.name}</td><td>${a.code}</td><td>${a.course}</td><td>
                    <button class="btn-action btn-accept" onclick="setPass('${id}','${a.name}','Ù†Ø§Ø¬Ø­')">Ù†Ø§Ø¬Ø­</button>
                    <button class="btn-action btn-reject" onclick="setPass('${id}','${a.name}','Ø±Ø§Ø³Ø¨')">Ø±Ø§Ø³Ø¨</button>
                </td></tr>`;
            }
        }
        document.getElementById('admAcc').innerHTML = hAcc;
        document.getElementById('admPass').innerHTML = hPass;
        document.getElementById('admPeriods').innerHTML = hPer;
        
        // Ø¹Ø±Ø¶ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ù„Ù„Ù…Ø´Ø±Ù
        for(let i in auth.courses) {
            let c = auth.courses[i];
            hSched += `<tr><td>${c.name}</td><td>${c.p1}</td><td>${c.p2}</td></tr>`;
        }
        document.querySelector("#mainSched tbody").innerHTML = hSched;
    });
</script>
